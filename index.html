<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ùïÆùñöùñòùñôùñîùñí ùñåùñäùñÜùñóùñò</title>
  <meta name="description" content="Custom Gears - Acess√≥rios personalizados para carros e estilo streetwear." />

  <!-- Fontes -->
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* ===========================
       RESET & ESTILIZA√á√ïES GERAIS
       ===========================
    */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #000;
      color: #fff;
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding-top: 70px;
    }
    header {
      font-family: 'UnifrakturCook', cursive;
      font-size: 3rem;
      text-align: center;
      padding: 1.5rem;
      border-bottom: 1px solid #333;
      color: #ccc;
      position: fixed;
      width: 100%;
      top: 0;
      background: #000;
      z-index: 1000;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 2rem;
      padding-top: 100px;
    }
    h2 {
      color: #aa88cc;
      font-family: 'UnifrakturCook', cursive;
      border-bottom: 1px solid #444;
      padding-bottom: 0.5rem;
      text-align: center;
    }
    button {
      background: #800080;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s;
      margin-top: 0.4rem;
    }
    button:hover:not(.sold-out-btn) { background: #a020f0; }
    .sold-out-btn {
      background: #555;
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* ===========================
       PRODUTOS E CARRINHO
       ===========================
    */
    .products {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1.5rem;
      margin: 2rem 0;
    }
    .product {
      background: #111;
      border: 1px solid #333;
      border-radius: 8px;
      width: 250px;
      padding: 1rem;
      text-align: center;
      transition: transform 0.2s ease;
      position: relative;
    }
    .product:hover { transform: scale(1.05); }
    .product img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }
    .product h3 {
      color: #ddd;
      margin: 0.5rem 0;
    }
    .product .price {
      color: #ccc;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .stock-label {
      font-size: 0.9rem;
      color: #ccc;
      margin-bottom: 0.5rem;
    }
    .sold-out-placeholder {
      width: 100%;
      height: 180px;
      background: #222;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #c00;
      font-size: 1.2rem;
      font-weight: bold;
    }

    /* √çcone do carrinho fixo */
    .cart {
      position: fixed;
      top: 72px;
      right: 20px;
      background: #222;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border: 1px solid #444;
      box-shadow: 0 0 5px #800080;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 100px;
      z-index: 1001;
    }
    .cart-count {
      background: #800080;
      padding: 2px 8px;
      border-radius: 50%;
      margin-left: 6px;
      font-size: 0.8rem;
    }

    /* POPUP DO CARRINHO */
    .cart-popup {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1002;
    }
    .cart-content {
      background: #333;
      padding: 15px; /* padding um pouco menor */
      border-radius: 8px;
      width: 90%;
      max-width: 300px; /* reduzido de 400px para 300px */
      text-align: center;
      max-height: 80vh;
      overflow-y: auto;
    }
    .cart-item {
      display: flex;
      align-items: center;
      margin: 8px 0; /* margem um pouco menor */
    }
    .cart-item img {
      width: 50px;   /* reduzido de 60px para 50px */
      height: 50px;  /* reduzido de 60px para 50px */
      object-fit: cover;
      border-radius: 4px;
      margin-right: 8px; /* margem um pouco menor */
    }
    .qty-btn {
      display: inline-block;
      padding: 0 6px;
      background: #555;
      color: #fff;
      border-radius: 4px;
      margin: 0 4px;
      cursor: pointer;
    }
    .remove {
      background: #f44336 !important;
      font-size: 0.8rem;
      padding: 0.3rem 0.6rem;
      margin-left: 8px;
    }
    .checkout {
      background: #4caf50 !important;
    }

    /* CUPOM DE DESCONTO */
    .coupon-section {
      margin: 1rem 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
    }
    .coupon-input {
      width: 55%;
      padding: 0.4rem;
      border-radius: 4px;
      border: 1px solid #555;
      background: #111;
      color: #fff;
      font-size: 0.9rem;
    }
    .coupon-btn {
      padding: 0.4rem 0.8rem;
      font-size: 0.9rem;
    }
    .coupon-message {
      font-size: 0.9rem;
      margin-top: 0.4rem;
      color: #ccc;
      text-align: center;
    }

    /* ALERTA CUSTOMIZADO */
    .custom-alert {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #6a0dad;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      z-index: 9999;
      animation: fadein 0.5s, fadeout 0.5s 1.5s;
    }
    @keyframes fadein {
      from { opacity: 0; transform: translateY(-20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeout {
      from { opacity: 1; transform: translateY(0); }
      to   { opacity: 0; transform: translateY(-20px); }
    }

    /* BOT√ÉO VOLTAR AO TOPO */
    #btnTop {
      display: none;
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 999;
      font-size: 1.5rem;
      outline: none;
      background-color: #800080;
      color: white;
      cursor: pointer;
      padding: 0.5rem 0.8rem;
      border: none;
      border-radius: 50%;
      box-shadow: 0 0 10px #800080;
      transition: background-color 0.3s;
    }
    #btnTop:hover { background-color: #a020f0; }
    @media (max-width:768px) {
      .products { flex-direction: column; align-items: center; }
      .product { width: 80%; }
    }

    /* =======================================================
       OVERLAY DE LOGIN / REGISTRO (invis√≠vel at√© necess√°rio)
       ======================================================== */
    #loginOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    #loginBox {
      background: #111;
      padding: 2rem;
      border-radius: 8px;
      width: 90%;
      max-width: 350px;
      text-align: center;
    }
    #loginBox h3 {
      margin-bottom: 1rem;
      color: #aa88cc;
      font-family: 'UnifrakturCook', cursive;
    }
    #loginBox input {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid #444;
      border-radius: 4px;
      background: #222;
      color: #fff;
      font-size: 1rem;
    }
    #loginBox .small-link {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #ccc;
      text-decoration: underline;
      cursor: pointer;
    }
    #loginMessage, #registerMessage {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #f55;
    }

    /* ================================
       CSS DO CARROSSEL DE FOTOS ABAIXO
       ================================
    */
    #gallery-section {
      width: 100%;
      background-color: #111;
      padding: 40px 0;
      box-sizing: border-box;
      overflow: hidden;
      margin-top: 2rem; /* espa√ßo extra entre produtos e carrossel */
      position: relative;
    }
    .carousel-container {
      width: 100%;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      display: flex;
      align-items: center;
      position: relative;
    }
    .carousel-track {
      display: flex;
      gap: 20px;
      padding: 0 2rem; /* para dar espa√ßo nas laterais */
    }
    .carousel-track img {
      width: 200px;        /* ajuste como preferir */
      height: 200px;       /* ou ‚Äúauto‚Äù para manter propor√ß√£o */
      object-fit: cover;
      border-radius: 4px;
      scroll-snap-align: start;
      cursor: pointer;      /* indica que d√° para clicar */
    }
    /* Esconde a barra de rolagem horizontal */
    .carousel-container::-webkit-scrollbar {
      display: none;
    }
    .carousel-container {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }

    /* Bot√µes de navega√ß√£o */
    .carousel-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.6);
      border: none;
      color: #fff;
      font-size: 2rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .carousel-button:hover {
      background: rgba(0,0,0,0.8);
    }
    .carousel-button.prev {
      left: 10px;
    }
    .carousel-button.next {
      right: 10px;
    }

    /* ================
       FOOTER CENTRALIZADO
       ================ */
    footer {
      background-color: #111;
      border-top: 1px solid #333;
      padding: 2rem 1rem;
      color: #ccc;
      text-align: center;
    }
    .footer-section {
      max-width: 800px;
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }
    .footer-block {
      text-align: center;
      line-height: 1.5;
    }
    .footer-block h4 {
      color: #aa88cc;
      margin-bottom: 0.5rem;
      font-family: 'UnifrakturCook', cursive;
      font-size: 1.2rem;
    }
    .footer-block p,
    .footer-block a {
      color: #ccc;
      font-size: 0.9rem;
      margin: 0.3rem 0;
      text-decoration: none;
    }
    .footer-block a:hover {
      text-decoration: underline;
    }
    .footer-bottom {
      margin-top: 1.5rem;
      font-size: 0.8rem;
      color: #777;
    }

    /* ================
       MODAL DE AMPLIA√á√ÉO
       ================ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }
    .modal-content {
      max-width: 90%;
      max-height: 90%;
    }
    .modal-content img {
      width: auto;
      height: auto;
      max-width: 100%;
      max-height: 100%;
      display: block;
      margin: auto;
      border-radius: 4px;
    }
    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      border: none;
      font-size: 2rem;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 2001;
    }
    .modal-close:hover {
      background: rgba(255,255,255,0.4);
    }
  </style>
</head>

<body>
  <!-- √çcone do Carrinho -->
  <div class="cart" onclick="toggleCartPopup()">
    üõí <span class="cart-count" id="cartCount">0</span>
  </div>

  <!-- HEADER fixo -->
  <header>Custom Gears</header>

  <!-- CONTAINER DE PRODUTOS (sempre vis√≠vel) -->
  <div class="container" id="mainContent">
    <h2>Produtos</h2>
    <div class="products" id="productList"></div>
  </div>

  <!-- ================
       CARROSSEL DE FOTOS (ABAIXO DOS PRODUTOS)
       ================ -->
  <section id="gallery-section">
    <button class="carousel-button prev" onclick="scrollCarousel(-1)">‚Äπ</button>
    <div class="carousel-container" id="carouselContainer">
      <div class="carousel-track">
        <!-- troque estas <img> pelas URLs reais das fotos dos seus produtos -->
        <img src="produtos/foto1.jpg" alt="Foto Produto 1">
        <img src="produtos/foto2.jpg" alt="Foto Produto 2">
        <img src="produtos/foto3.jpg" alt="Foto Produto 3">
        <img src="produtos/foto4.jpg" alt="Foto Produto 4">
        <img src="produtos/foto5.jpg" alt="Foto Produto 5">
        <!-- adicione ou remova conforme a quantidade de imagens -->
      </div>
    </div>
    <button class="carousel-button next" onclick="scrollCarousel(1)">‚Ä∫</button>
  </section>

  <!-- ================
       MODAL PARA AMPLIAR IMAGENS
       ================ -->
  <div class="modal-overlay" id="modalOverlay">
    <button class="modal-close" id="modalClose">√ó</button>
    <div class="modal-content" id="modalContent">
      <!-- A imagem ampliada ser√° inserida aqui via JS -->
    </div>
  </div>

  <!-- ================
       FOOTER CENTRALIZADO
       ================ -->
  <footer id="mainFooter">
    <div class="footer-section">
      <!-- Sobre N√≥s -->
      <div class="footer-block">
        <h4>Sobre N√≥s</h4>
        <p>Na Custom Gears, transformamos paix√£o automotiva em estilo. Criamos roupas e acess√≥rios exclusivos, inspirados na cultura automotiva e no esp√≠rito livre das ruas.</p>
      </div>

      <!-- Contato -->
      <div class="footer-block">
        <h4>Contato</h4>
        <p>Telefone: (41) 99973-7694</p>
        <p>Email: <a href="mailto:Customgears17@gmail.com">Customgears17@gmail.com</a></p>
      </div>

      <!-- Redes Sociais -->
      <div class="footer-block">
        <h4>Redes Sociais</h4>
        <p><a href="https://www.instagram.com/custom_gears17?igsh=bmVtODg0cDk2NWEz" target="_blank">Instagram</a></p>
      </div>
    </div>

    <div class="footer-bottom">
      ¬© 2025 Custom Gears. Todos os direitos reservados.
    </div>
  </footer>

  <!-- POPUP DO CARRINHO -->
  <div class="cart-popup" id="cartPopup">
    <div class="cart-content">
      <!-- T√≠tulo alterado conforme solicitado: -->
      <h3>Carrinho de Compras üõí</h3>
      <div id="cartItems"></div>

      <!-- Se√ß√£o do cupom de desconto -->
      <div class="coupon-section">
        <input type="text" id="couponCode" class="coupon-input" placeholder="Digite seu cupom">
        <button class="coupon-btn" onclick="applyCoupon()">Aplicar Cupom</button>
      </div>
      <div id="couponMessage" class="coupon-message"></div>

      <!-- Totais -->
      <p id="cartTotal"></p>
      <p id="discountedTotal" style="color:#aa88cc; font-weight:bold;"></p>

      <!-- Bot√£o de checkout -->
      <button onclick="checkout()" class="checkout">Chamar no WhatsApp</button>
      <button onclick="closeCart()" style="margin-top:0.4rem;">Fechar</button>
    </div>
  </div>

  <!-- Overlay de LOGIN/REGISTRO (aparece apenas quando for preciso) -->
  <div id="loginOverlay">
    <div id="loginBox">
      <h3>Custom Gears</h3>

      <!-- FORMUL√ÅRIO DE LOGIN -->
      <div id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" autocomplete="username" />
        <input type="password" id="loginPassword" placeholder="Senha" autocomplete="current-password" />
        <button onclick="loginUser()">Entrar</button>
        <div id="loginMessage"></div>
        <div class="small-link" onclick="showRegister()">N√£o tem conta? Cadastre-se</div>
      </div>

      <!-- FORMUL√ÅRIO DE REGISTRO -->
      <div id="registerForm" style="display:none;">
        <input type="email" id="regEmail" placeholder="Seu email" autocomplete="username" />
        <input type="password" id="regPassword" placeholder="Sua senha" autocomplete="new-password" />
        <button onclick="registerUser()">Registrar</button>
        <div id="registerMessage"></div>
        <div class="small-link" onclick="showLogin()">J√° tem conta? Entrar</div>
      </div>
    </div>
  </div>

  <!-- Bot√£o de voltar ao topo -->
  <button onclick="scrollToTop()" id="btnTop" title="Voltar ao Topo">‚Üë</button>

  <script>
    /* =====================================================
       VARI√ÅVEIS GLOBAIS E DADOS INICIAIS
       ====================================================== */
    const products = [
      { id:1, name:'Camiseta oversized Custom Gears', price:119.90, img:'https://i.postimg.cc/G3zD0FLD/camisa1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['P','M','G','GG','XG'] },
      { id:2, name:'Blusa moletom com capuz Custom Gears', price:159.90, img:'https://i.postimg.cc/dtZXDB2x/manopla1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['P','M','G','GG','XG'] },
      { id:3, name:'Blusa moletom Custom Gears', price:149.90, img:'https://i.postimg.cc/dtZXDB2x/manopla1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['P','M','G','GG','XG'] },
      { id:4, name:'Cal√ßa moletom Custom Gears', price:139.90, img:'https://i.postimg.cc/dtZXDB2x/manopla1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['P','M','G','GG','XG'] },
      { id:5, name:'Meias cano alto Custom Gears', price:29.90, img:'https://i.postimg.cc/dtZXDB2x/manopla1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['M','G','GG'] },
      { id:6, name:'Manopla c√¢mbio inox Custom Gears', img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Cinza','Cromado'], sizes:['4 polegadas'], sizePrices:{'4 polegadas':39.90} },
      { id:7, name:'Bandeira Custom Gears', img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco'], sizes:['90√ó150cm','122√ó183cm'], sizePrices:{'90√ó150cm':49.90,'122√ó183cm':59.90} },
      { id:8, name:'Coifa c√¢mbio Custom Gears', img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['Universal'], sizePrices:{'Universal':24.90} },
      { id:9, name:'Copo t√©rmico personalizado Custom Gears', img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Preto','Branco','Cinza'], sizes:['400ml','470ml'], sizePrices:{'400ml':19.90,'470ml':24.90} },
      { id:10, name:'Chaveiro cord√£o Custom Gears', img:'https://i.postimg.cc/J04rPZ4y/volante1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['2,5cm√ó54cm','3,5cm√ó14,5cm','2,5cm√ó19cm'], sizePrices:{'2,5cm√ó54cm':29.90,'3,5cm√ó14,5cm':14.90,'2,5cm√ó19cm':19.90} },
      { id:11, name:'Adesivos refletivos Custom Gears', img:'https://i.postimg.cc/nVqD3dzV/chaveiro1.jpg', colors:['Branco','Cinza'], sizes:['100cm√ó10cm','60cm√ó6cm'], sizePrices:{'100cm√ó10cm':59.90,'60cm√ó6cm':44.90} },
      { id:12, name:'Aromatizante automotivo Custom Gears', img:'https://i.postimg.cc/nVqD3dzV/chaveiro1.jpg', colors:['Branco','Preto','Cinza','Roxo'], sizes:['5,4cm√ó5,4cm','7,7cm√ó5,4cm'], sizePrices:{'5,4cm√ó5,4cm':7.90,'7,7cm√ó5,4cm':11.90} }
    ];

    // Estoque inicial: 5 unidades por combina√ß√£o cor|tamanho
    const inventory = {};
    products.forEach(p => {
      inventory[p.id] = {};
      const colors = p.colors || [];
      const sizes = p.sizes || [];
      colors.forEach(c => sizes.forEach(s => {
        inventory[p.id][`${c}|${s}`] = 5;
      }));
    });

    // Cupons de desconto
    const coupons = {
      'CUSTOM10': 10,
      'CUSTOM20': 20,
      'FRETEGRATIS': 5
    };
    let appliedCoupon = null;

    // Carrinho e persist√™ncia
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    // Armazena √∫ltima sele√ß√£o de cor/tamanho para cada produto
    const lastSelection = {};

    /* ================================================
       Ajusta estoque de acordo com carrinho j√° salvo
       (apenas na carga inicial da p√°gina)
       ================================================ */
    function adjustInventoryFromLocalCart() {
      cart.forEach(item => {
        const key = `${item.color}|${item.size}`;
        if (inventory[item.id] && inventory[item.id][key] !== undefined) {
          inventory[item.id][key] = Math.max(inventory[item.id][key] - item.quantity, 0);
        }
      });
    }

    /* ================================================
       SALVA sele√ß√µes atuais de <select> antes de re-render
       ================================================ */
    function saveCurrentSelections() {
      products.forEach(p => {
        const colorEl = document.getElementById(`cor-${p.id}`);
        const sizeEl  = document.getElementById(`tam-${p.id}`);
        if (colorEl && sizeEl) {
          lastSelection[p.id] = {
            color: colorEl.value,
            size: sizeEl.value
          };
        }
      });
    }

    /* ================================================
       L√ìGICA DE USU√ÅRIO (LOGIN / REGISTRO)
       ================================================ */
    function getUsers() {
      return JSON.parse(localStorage.getItem('users') || '[]');
    }
    function setUsers(arr) {
      localStorage.setItem('users', JSON.stringify(arr));
    }

    function showLogin() {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('registerForm').style.display = 'none';
      document.getElementById('loginMessage').textContent = '';
      document.getElementById('registerMessage').textContent = '';
    }
    function showRegister() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('registerForm').style.display = 'block';
      document.getElementById('loginMessage').textContent = '';
      document.getElementById('registerMessage').textContent = '';
    }

    function registerUser() {
      const email = document.getElementById('regEmail').value.trim();
      const password = document.getElementById('regPassword').value.trim();
      const msgEl = document.getElementById('registerMessage');

      if (!email || !password) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'Preencha e-mail e senha.';
        return;
      }
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'E-mail inv√°lido.';
        return;
      }
      const users = getUsers();
      if (users.find(u => u.email === email)) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'E-mail j√° cadastrado.';
        return;
      }
      users.push({ email, password });
      setUsers(users);
      msgEl.style.color = '#6a0';
      msgEl.textContent = 'Registrado com sucesso! Fa√ßa login.';
      setTimeout(showLogin, 1500);
    }

    function loginUser() {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value.trim();
      const msgEl = document.getElementById('loginMessage');

      if (!email || !password) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'Preencha e-mail e senha.';
        return;
      }
      const users = getUsers();
      const found = users.find(u => u.email === email && u.password === password);
      if (!found) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'Credenciais inv√°lidas.';
        return;
      }
      localStorage.setItem('currentUser', email);
      document.getElementById('loginOverlay').style.display = 'none';
      if (typeof pendingCheckout === 'function') {
        pendingCheckout();
        pendingCheckout = null;
      }
    }

    function logoutUser() {
      localStorage.removeItem('currentUser');
      location.reload();
    }

    /* ================================================
       RENDERIZA√á√ÉO E INTERA√á√ÉO (sem sobrescrever sele√ß√£o)
       ================================================ */
    function renderProducts() {
      const list = document.getElementById('productList');
      list.innerHTML = '';

      products.forEach(p => {
        const card = document.createElement('div');
        card.className = 'product';
        card.id = `prod-${p.id}`;

        // Descobre quais combina√ß√µes (cor|tamanho) ainda t√™m estoque:
        const inStockKeys = Object.keys(inventory[p.id]).filter(k => inventory[p.id][k] > 0);

        if (inStockKeys.length === 0) {
          card.innerHTML = `
            <div class="sold-out-placeholder">ESGOTADO</div>
            <h3>${p.name}</h3>
          `;
        } else {
          const colors = [...new Set(inStockKeys.map(k => k.split('|')[0]))];
          const sizes  = [...new Set(inStockKeys.map(k => k.split('|')[1]))];

          // Verifica se j√° existia sele√ß√£o anterior; sen√£o, usa a primeira op√ß√£o:
          const prev = lastSelection[p.id] || { color: colors[0], size: sizes[0] };
          const selColor = colors.includes(prev.color) ? prev.color : colors[0];
          const selSize  = sizes.includes(prev.size)  ? prev.size  : sizes[0];

          const priceValue = p.sizePrices
            ? p.sizePrices[selSize]
            : p.price;

          card.innerHTML = `
            <img src="${p.img}" alt="${p.name}" class="prod-img" data-id="${p.id}" />
            <h3>${p.name}</h3>
            <p class="price">R$${priceValue.toFixed(2)}</p>
            <p class="stock-label">Estoque: ${inventory[p.id][`${selColor}|${selSize}`]}</p>
            <label>Cor:
              <select id="cor-${p.id}">
                ${colors.map(c => 
                  `<option value="${c}" ${c === selColor ? 'selected' : ''}>${c}</option>`
                ).join('')}
              </select>
            </label><br>
            <label>Tamanho:
              <select id="tam-${p.id}">
                ${sizes.map(s => 
                  `<option value="${s}" ${s === selSize ? 'selected' : ''}>${s}</option>`
                ).join('')}
              </select>
            </label><br>
            <button id="btn-${p.id}">Adicionar ao Carrinho</button>
          `;
        }

        list.appendChild(card);
      });

      initProductListeners();
      updateCartCount();

      // Adiciona listener de clique para abrir modal ao clicar na imagem do produto
      document.querySelectorAll('.prod-img').forEach(img => {
        img.addEventListener('click', () => {
          openModal(img.src);
        });
      });
    }

    function initProductListeners() {
      products.forEach(p => {
        const sizeEl  = document.getElementById(`tam-${p.id}`);
        const colorEl = document.getElementById(`cor-${p.id}`);
        const btn     = document.getElementById(`btn-${p.id}`);

        if (sizeEl) {
          sizeEl.addEventListener('change', () => {
            updatePriceBySize(p.id);
            updateStockLabel(p.id);
          });
        }
        if (colorEl) {
          colorEl.addEventListener('change', () => updateStockLabel(p.id));
        }
        if (btn) {
          btn.addEventListener('click', () => addToCart(p.id));
        }
      });
    }

    function updatePriceBySize(id) {
      const size = document.getElementById(`tam-${id}`).value;
      const prod = products.find(x => x.id === id);
      const price = prod.sizePrices ? prod.sizePrices[size] : prod.price;
      document.querySelector(`#prod-${id} .price`).textContent = `R$${price.toFixed(2)}`;
    }

    function updateStockLabel(id) {
      const colorSelect = document.getElementById(`cor-${id}`);
      const sizeSelect  = document.getElementById(`tam-${id}`);
      if (!colorSelect || !sizeSelect) return;

      const color = colorSelect.value;
      const size  = sizeSelect.value;
      const stock = inventory[id][`${color}|${size}`] || 0;
      const label = document.querySelector(`#prod-${id} .stock-label`);
      label.textContent = `Estoque: ${stock}`;
    }

    function addToCart(id) {
      // 1) Salva sele√ß√£o atual antes de alterar qualquer coisa
      saveCurrentSelections();

      const color = document.getElementById(`cor-${id}`).value;
      const size  = document.getElementById(`tam-${id}`).value;
      const key   = `${color}|${size}`;

      if (inventory[id][key] < 1) {
        return; // sem estoque
      }

      // 2) Adiciona no array do carrinho
      const existing = cart.find(i => i.id === id && i.color === color && i.size === size);
      if (existing) {
        existing.quantity++;
      } else {
        cart.push({ id, color, size, quantity: 1 });
      }

      // 3) Diminui estoque
      inventory[id][key]--;

      // 4) Persiste no localStorage
      localStorage.setItem('cart', JSON.stringify(cart));

      // 5) Re-renderiza (mantendo as sele√ß√µes)
      renderProducts();
      showAlert('Adicionado ao carrinho');
    }

    function toggleCartPopup() {
      const popup = document.getElementById('cartPopup');
      if (popup.style.display === 'flex') {
        closeCart();
      } else {
        renderCartPopup();
        popup.style.display = 'flex';
      }
    }

    function renderCartPopup() {
      const container = document.getElementById('cartItems');
      container.innerHTML = '';

      if (!cart.length) {
        container.innerHTML = `<p style="color:#ccc; margin:1rem 0;">Seu carrinho est√° vazio.</p>`;
        document.getElementById('cartTotal').textContent = '';
        document.getElementById('discountedTotal').textContent = '';
        document.getElementById('couponMessage').textContent = '';
        appliedCoupon = null;
        return;
      }

      let total = 0;
      cart.forEach(item => {
        const prod = products.find(p => p.id === item.id);
        const price = prod.sizePrices ? prod.sizePrices[item.size] : prod.price;
        total += price * item.quantity;

        // Cada item agora exibe a miniatura da foto do produto
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <img src="${prod.img}" alt="${prod.name}">
          <div>
            <p>${prod.name} ‚Äì ${item.color}/${item.size}</p>
            <div>
              <span class="qty-btn" onclick="changeQty(${item.id}, '${item.color}', '${item.size}', -1)">‚Äì</span>
              <span>${item.quantity}</span>
              <span class="qty-btn" onclick="changeQty(${item.id}, '${item.color}', '${item.size}', 1)">+</span>
              <button class="remove" onclick="removeFromCart(${item.id}, '${item.color}', '${item.size}')">Remover</button>
            </div>
          </div>
        `;
        container.appendChild(div);
      });

      document.getElementById('cartTotal').textContent = `Total: R$${total.toFixed(2)}`;

      if (appliedCoupon) {
        const discountPercent = coupons[appliedCoupon];
        const discountedValue = total * (1 - discountPercent / 100);
        document.getElementById('discountedTotal').textContent =
          `Total com "${appliedCoupon}": R$${discountedValue.toFixed(2)} (${discountPercent}% off)`;
      } else {
        document.getElementById('discountedTotal').textContent = '';
      }
      document.getElementById('couponMessage').textContent = '';
    }

    function changeQty(id, color, size, delta) {
      saveCurrentSelections();

      const key = `${color}|${size}`;
      const item = cart.find(i => i.id === id && i.color === color && i.size === size);
      if (!item) return;

      if (delta > 0) {
        if (inventory[id][key] < 1) return;
        item.quantity++;
        inventory[id][key]--;
      } else {
        item.quantity--;
        inventory[id][key]++;
      }

      if (item.quantity === 0) {
        cart = cart.filter(i => !(i.id === id && i.color === color && i.size === size));
      }

      localStorage.setItem('cart', JSON.stringify(cart));
      renderProducts();
      renderCartPopup();
    }

    function removeFromCart(id, color, size) {
      saveCurrentSelections();

      const key = `${color}|${size}`;
      const item = cart.find(i => i.id === id && i.color === color && i.size === size);
      if (!item) return;

      inventory[id][key] += item.quantity;
      cart = cart.filter(i => !(i.id === id && i.color === color && i.size === size));
      localStorage.setItem('cart', JSON.stringify(cart));

      renderProducts();
      renderCartPopup();
    }

    function closeCart() {
      document.getElementById('cartPopup').style.display = 'none';
    }

    function applyCoupon() {
      const code = document.getElementById('couponCode').value.trim().toUpperCase();
      const msgEl = document.getElementById('couponMessage');

      if (!code) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'Digite um cupom.';
        return;
      }
      if (!cart.length) {
        msgEl.style.color = '#f55';
        msgEl.textContent = 'Seu carrinho est√° vazio.';
        return;
      }
      if (coupons[code]) {
        appliedCoupon = code;
        msgEl.style.color = '#6a0';
        msgEl.textContent = `Cupom "${code}" aplicado: ${coupons[code]}% de desconto!`;
      } else {
        appliedCoupon = null;
        msgEl.style.color = '#f55';
        msgEl.textContent = `"${code}" n√£o √© um cupom v√°lido.`;
      }
      renderCartPopup();
    }

    let pendingCheckout = null;

    function checkout() {
      const currentUser = localStorage.getItem('currentUser');
      if (!cart.length) return;

      if (!currentUser) {
        pendingCheckout = checkout;
        document.getElementById('loginOverlay').style.display = 'flex';
        showLogin();
        return;
      }

      let msg = 'Ol√°, gostaria de comprar:\n';
      let total = 0;
      cart.forEach(item => {
        const prod = products.find(p => p.id === item.id);
        const unitPrice = prod.sizePrices ? prod.sizePrices[item.size] : prod.price;
        const lineTotal = unitPrice * item.quantity;
        total += lineTotal;
        msg += `- ${prod.name} (${item.color}/${item.size}) x${item.quantity} ‚Äì R$${lineTotal.toFixed(2)}\n`;
      });
      if (appliedCoupon && coupons[appliedCoupon]) {
        const discountPercent = coupons[appliedCoupon];
        const discountedValue = total * (1 - discountPercent / 100);
        msg += `\nTotal com "${appliedCoupon}": R$${discountedValue.toFixed(2)} (${discountPercent}% off)`;
      } else {
        msg += `\nTotal: R$${total.toFixed(2)}`;
      }

      const historyKey = `history_${currentUser}`;
      const previousHistory = JSON.parse(localStorage.getItem(historyKey) || '[]');
      const purchaseRecord = {
        date: new Date().toLocaleString('pt-BR'),
        items: cart.map(item => ({
          id: item.id,
          name: products.find(p => p.id === item.id).name,
          color: item.color,
          size: item.size,
          quantity: item.quantity,
          unitPrice: (products.find(p => p.id === item.id).sizePrices || {})[item.size] || products.find(p => p.id === item.id).price
        })),
        coupon: appliedCoupon || null,
        total: appliedCoupon
          ? Number((total * (1 - coupons[appliedCoupon] / 100)).toFixed(2))
          : Number(total.toFixed(2))
      };
      previousHistory.push(purchaseRecord);
      localStorage.setItem(historyKey, JSON.stringify(previousHistory));

      const phone = '5541999737694';
      window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');

      cart = [];
      localStorage.removeItem('cart');
      appliedCoupon = null;
      renderProducts();
      renderCartPopup();
    }

    function updateCartCount() {
      const count = cart.reduce((acc, i) => acc + i.quantity, 0);
      document.getElementById('cartCount').textContent = count;
    }

    function showAlert(text) {
      const div = document.createElement('div');
      div.className = 'custom-alert';
      div.textContent = text;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 2000);
    }

    window.addEventListener('scroll', () => {
      const btn = document.getElementById('btnTop');
      btn.style.display = window.scrollY > 300 ? 'block' : 'none';
    });
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ======================================
       FUN√á√ÉO PARA NAVAGAR CARROSSEL
       ====================================== */
    function scrollCarousel(direction) {
      const container = document.getElementById('carouselContainer');
      // Move uma ‚Äúview‚Äù completa (largura vis√≠vel) para a esquerda ou direita
      const scrollAmount = container.clientWidth * direction;
      container.scrollBy({ left: scrollAmount, behavior: 'smooth' });
    }

    /* ======================================
       FUN√á√ÉO PARA ABRIR O MODAL DE IMAGEM
       ====================================== */
    function openModal(src) {
      const modalOverlay = document.getElementById('modalOverlay');
      const modalContent = document.getElementById('modalContent');
      modalContent.innerHTML = `<img src="${src}" alt="Imagem ampliada">`;
      modalOverlay.style.display = 'flex';
    }
    function closeModal() {
      document.getElementById('modalOverlay').style.display = 'none';
    }

    /* ======================================
       L√ìGICA GERAL (produtos + carrossel + modal)
       ====================================== */
    document.addEventListener('DOMContentLoaded', () => {
      // Ajusta o estoque a partir do que j√° estiver no carrinho salvo
      adjustInventoryFromLocalCart();
      // Renderiza produtos e atualiza o contador
      renderProducts();
      updateCartCount();

      // Ao clicar em qualquer imagem do carrossel, abre o modal
      document.querySelectorAll('.carousel-track img').forEach(img => {
        img.addEventListener('click', () => {
          openModal(img.src);
        });
      });

      // Fecha o modal ao clicar no ‚Äú√ó‚Äù
      document.getElementById('modalClose').addEventListener('click', closeModal);
      // Fecha o modal tamb√©m se clicar fora da imagem (na sobreposi√ß√£o escura)
      document.getElementById('modalOverlay').addEventListener('click', e => {
        if (e.target.id === 'modalOverlay') closeModal();
      });
    });
  </script>
</body>
  </html>
